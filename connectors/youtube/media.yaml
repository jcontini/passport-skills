# YouTube provider for Media app
# Uses yt-dlp via the command: executor

actions:
  metadata:
    label: Get video info
    readonly: true
    command:
      binary: yt-dlp
      args:
        - "--dump-json"
        - "--skip-download"
        - "{{params.url}}"
      timeout: 30
    response:
      mapping:
        id: "{{id}}"
        title: "{{title}}"
        creator: "{{channel}}"
        description: "{{description}}"
        duration: "{{duration}}"
        url: "{{webpage_url}}"
        thumbnail: "{{thumbnail}}"
        view_count: "{{view_count}}"
        upload_date: "{{upload_date}}"
        type: video

  transcribe:
    label: Get transcript
    readonly: true
    command:
      binary: yt-dlp
      args:
        - "--skip-download"
        - "--write-auto-sub"
        - "--sub-lang"
        - "{{params.lang}}"
        - "--convert-subs"
        - "srt"
        - "--print"
        - "requested_subtitles"
        - "-o"
        - "-"
        - "{{params.url}}"
      timeout: 120

  download:
    label: Download video
    command:
      binary: yt-dlp
      args:
        - "-f"
        - "best[height<={{params.quality}}]/best"
        - "-o"
        - "~/Downloads/%(title)s.%(ext)s"
        - "--print"
        - "after_move:filepath"
        - "{{params.url}}"
      timeout: 600
    response:
      mapping:
        path: "{{output}}"

  audio:
    label: Extract audio (mp3)
    command:
      binary: yt-dlp
      args:
        - "-x"
        - "--audio-format"
        - "mp3"
        - "-o"
        - "~/Downloads/%(title)s.%(ext)s"
        - "--print"
        - "after_move:filepath"
        - "{{params.url}}"
      timeout: 600
    response:
      mapping:
        path: "{{output}}"
